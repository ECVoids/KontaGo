<!DOCTYPE html>
{% extends 'base.html' %}

{% block title %}Inventario - KontaGo{% endblock %}

{% block content %}
<style>
  /* ===== Base ===== */
  h1 {
    text-align: center;
    color: #4b2e2e;
    margin-bottom: 20px;
  }

  /* ===== Men√∫ hamburguesa ===== */
  .menu-container {
    position: relative;
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }

  .menu-toggle {
    background-color: #a97155;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }

  .menu-toggle:hover {
    background-color: #8b5e3c;
  }

  .dropdown-menu {
    display: none;
    position: absolute;
    top: 55px;
    background-color: #fffaf3;
    border: 1px solid #d9c7a6;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    padding: 10px;
    z-index: 100;
    width: 260px;
  }

  .dropdown-menu a {
    display: block;
    background: #a97155;
    color: white;
    text-decoration: none;
    padding: 10px 14px;
    border-radius: 8px;
    margin: 6px 0;
    font-weight: 700;
    transition: background 0.2s;
  }

  .dropdown-menu a:hover {
    background: #8b5e3c;
  }

  /* Mostrar men√∫ activo */
  .menu-container.active .dropdown-menu {
    display: block;
  }

  /* ===== Bot√≥n volver ===== */
  .btn-home {
    display: block;
    width: fit-content;
    margin: 30px auto 0;
    padding: 12px 20px;
    background: #4b2e2e;
    color: #fff;
    text-decoration: none;
    border-radius: 8px;
    font-size: 16px;
    transition: background .2s;
  }
  .btn-home:hover {
    background: #3e2723;
  }

  /* ===== Mensajes ===== */
  .messages-container {
    max-width: 600px;
    margin: 0 auto 20px;
  }
  .message {
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 8px;
    font: 700 15px/1 Arial;
  }
  .message.success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }
  .message.error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }

  /* ===== Filtros ===== */
.filters-form {
  max-width: 1200px;
  margin: 24px auto 30px;
  background: #fffaf3;
  border: 1px solid #e8dcca;
  border-radius: 16px;
  padding: 20px 28px;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
}

.filters-grid {
  display: grid;
  grid-template-columns: repeat(12, 1fr);
  gap: 18px;
  align-items: end;
}

.label {
  display: block;
  margin-bottom: 6px;
  color: #5d4037;
  font-weight: 600;
  font-size: 14px;
}

.input,
.select {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #d6ccc2;
  border-radius: 8px;
  background-color: #fff;
  font-size: 15px;
  color: #4b2e2e;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.input:focus,
.select:focus {
  border-color: #b08968;
  box-shadow: 0 0 0 3px rgba(176, 137, 104, 0.25);
  outline: none;
}

.f-actions {
  grid-column: 1 / -1;
  display: flex;
  gap: 14px;
  justify-content: center;
  margin-top: 10px;
}

.btn-search {
  background-color: #b08968;
  color: #fff;
  border: none;
  padding: 10px 22px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 700;
  font-size: 15px;
  transition: background-color 0.2s, transform 0.1s;
}

.btn-search:hover {
  background-color: #9c6644;
  transform: scale(1.03);
}

.link-clear {
  color: #6d4c41;
  font-weight: 600;
  text-decoration: none;
  align-self: center;
  transition: color 0.2s;
}

.link-clear:hover {
  color: #9c6644;
  text-decoration: underline;
}

@media (max-width: 768px) {
  .filters-grid {
    grid-template-columns: 1fr;
  }
  .f-item {
    grid-column: span 12 !important;
  }
}


  /* ===== Resto de estilos (filtros, tarjetas, etc.) ===== */
  .filters-form {
    max-width: 1200px;
    margin: 16px auto 22px;
    background: #f7efe2;
    border: 1px solid #e8dcca;
    border-radius: 14px;
    padding: 16px;
  }
  .filters-grid {
    display: grid;
    gap: 14px;
    align-items: end;
    grid-template-columns: repeat(12, minmax(0, 1fr));
  }
  .f-item {
    grid-column: span 4;
  }
  .f-actions {
    grid-column: 1 / -1;
    display: flex;
    gap: 12px;
    justify-content: center;
  }

  .inventory-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .card {
    background: #fffaf3;
    border: 1px solid #d9c7a6;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 2px 4px 6px rgba(0,0,0,.1);
    text-align: center;
  }

  .card img {
    width: 100%;
    max-height: 200px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 15px;
  }

  .btn {
    display: inline-block;
    min-width: 150px;
    padding: 12px 20px;
    margin: 10px auto 0;
    font: 700 15px/1 Arial;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-align: center;
  }

  .btn-add { background: #6d4c41; color: #fff; }
  .btn-add:hover { background: #5d4037; }
  .btn-delete { background: #8d3c2b; color: #fff; }
  .btn-delete:hover { background: #6e2c1a; }

  @media (max-width:600px){
    .dropdown-menu { width: 90%; left: 5%; }
  }
</style>

<script>
  // Script para alternar el men√∫
  document.addEventListener('DOMContentLoaded', () => {
    const menuContainer = document.querySelector('.menu-container');
    const toggle = document.querySelector('.menu-toggle');

    toggle.addEventListener('click', () => {
      menuContainer.classList.toggle('active');
    });

    // Cierra el men√∫ al hacer clic fuera
    document.addEventListener('click', (e) => {
      if (!menuContainer.contains(e.target)) {
        menuContainer.classList.remove('active');
      }
    });
  });
</script>

<h1>Inventario de Productos</h1>

<!-- ===== Men√∫ desplegable ===== -->
<div class="menu-container">
  <button class="menu-toggle">‚ò∞ Opciones</button>
  <div class="dropdown-menu">
    <a href="{% url 'product_entry' %}">‚ûï Crear Producto</a>
    <a href="{% url 'inventory_pdf' %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">üìÑ Exportar PDF buscador</a>
    <a href="{% url 'graphics' %}">üìä Gr√°ficas</a>
    <a href="{% url 'selling_suggestions' %}">üí∞ Sugerencia de ventas (IA)</a>
    <a href="{% url 'restock_recommendations' %}">ü§ñ Reabastecimiento (IA)</a>
    <a href="{% url 'slow_inventory_alerts' %}">‚ö†Ô∏è Inventario Lento (IA)</a>
  </div>
</div>

{% if messages %}
<div class="messages-container">
  {% for message in messages %}
  <div class="message {{ message.tags }}">{{ message }}</div>
  {% endfor %}
</div>
{% endif %}

<!-- ===== Filtros ===== -->
<form method="get" class="filters-form">
  <div class="filters-grid">
    <div class="f-item" style="grid-column: 1 / span 7;">
      <input type="text" name="q" class="input"
        placeholder="Buscar por nombre, descripci√≥n, categor√≠a o proveedor‚Ä¶"
        value="{{ filters.q }}">
    </div>

    <div class="f-item" style="grid-column: 9 / span 4;">
      <label class="label">Categor√≠a</label>
      <select name="category" class="select">
        <option value="">Todas</option>
        {% for c in categories %}
        <option value="{{ c }}" {% if filters.category == c %}selected{% endif %}>{{ c|title }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="f-item" style="grid-column: 1 / span 4;">
      <label class="label">Proveedor</label>
      <select name="supplier" class="select">
        <option value="">Todos</option>
        {% for s in suppliers %}
        <option value="{{ s }}" {% if filters.supplier == s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="f-item" style="grid-column: 5 / span 3;">
      <label class="label">Precio m√≠n</label>
      <input type="number" step="0.01" name="min_price" class="input" value="{{ filters.min_price }}">
    </div>

    <div class="f-item" style="grid-column: 9 / span 3;">
      <label class="label">Precio m√°x</label>
      <input type="number" step="0.01" name="max_price" class="input" value="{{ filters.max_price }}">
    </div>

    <div class="f-actions">
      <button type="submit" class="btn-search">üîé Buscar</button>
      <a href="{% url 'inventory_display' %}" class="link-clear">Limpiar</a>
    </div>
  </div>
</form>

<!-- ===== Productos ===== -->
<div class="inventory-container">
  {% for product in products %}
  <div class="card">
    {% if product.image %}
    <img src="{{ product.image.url }}" alt="{{ product.name }}">
    {% endif %}
    <h2>{{ product.name }}</h2>
    <p><strong>Categor√≠a:</strong> {{ product.get_category_display }}</p>
    {% if product.expiration_date %}
    <p><strong>Fecha de expiraci√≥n:</strong> {{ product.expiration_date }}</p>
    {% endif %}
    <p><strong>Proveedor:</strong> {{ product.supplier }}</p>
    <p><strong>Precio:</strong> ${{ product.price }}</p>
    <p><strong>Stock:</strong> {{ product.quantity }}</p>
    <p><strong>Descripci√≥n:</strong> {{ product.description }}</p>

    <details style="margin-top:10px; background:#f7efe2; border:1px solid #d9c7a6; border-radius:10px; padding:10px;">
      <summary style="cursor:pointer; font-weight:bold; color:#6d4c41;">üìã Sugerencias de Almacenamiento & Manejo</summary>
      <div style="margin-top:8px; text-align:left; color:#4e342e; font-size:14px; white-space:pre-wrap;">
        {{ product.product_assigned_suggestions }}
      </div>
    </details>

    <a href="{% url 'add_unit' product.id %}" class="btn btn-add">‚ûï A√±adir unidad</a>
    <a href="{% url 'delete_product' product.id %}" class="btn btn-delete"
      onclick="return confirm('¬øSeguro que quieres eliminar {{ product.name }}?');">
      üóë Eliminar producto
    </a>
  </div>
  {% empty %}
  <p style="text-align:center; color:#6d4c41;">No hay productos en el inventario.</p>
  {% endfor %}
</div>

<!-- ===== Paginaci√≥n ===== -->
{% if page_obj.has_other_pages %}
  <div style="text-align:center; margin:30px 0;">
    <div style="display:inline-flex; gap:6px; flex-wrap:wrap;">

      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
           style="padding:8px 12px; background:#a97155; color:white; border-radius:6px; text-decoration:none;">
          ‚Üê Anterior
        </a>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <span style="padding:8px 12px; background:#4b2e2e; color:white; border-radius:6px;">{{ num }}</span>
        {% elif num > page_obj.number|add:-3 and num < page_obj.number|add:3 %}
          <a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
             style="padding:8px 12px; background:#d9c7a6; color:#4b2e2e; border-radius:6px; text-decoration:none;">
             {{ num }}
          </a>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
           style="padding:8px 12px; background:#a97155; color:white; border-radius:6px; text-decoration:none;">
          Siguiente ‚Üí
        </a>
      {% endif %}
    </div>
  </div>
{% endif %}

<a href="{% url 'home' %}" class="btn-home">‚¨Ö Volver a inicio</a>

{% endblock %}
