<!DOCTYPE html>
{% extends 'base.html' %}

{% block title %}Inventario - KontaGo{% endblock %}

{% block content %}
<style>
  /* ===== Base ===== */
  h1 {
    text-align: center;
    color: #4b2e2e;
    margin-bottom: 20px;
  }

  /* ===== Men√∫ hamburguesa ===== */
  .menu-container {
    position: relative;
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }

  .menu-toggle {
    background-color: #a97155;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }

  .menu-toggle:hover {
    background-color: #8b5e3c;
  }

  .dropdown-menu {
    display: none;
    position: absolute;
    top: 55px;
    background-color: #fffaf3;
    border: 1px solid #d9c7a6;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    padding: 10px;
    z-index: 100;
    width: 260px;
  }

  .dropdown-menu a {
    display: block;
    background: #a97155;
    color: white;
    text-decoration: none;
    padding: 10px 14px;
    border-radius: 8px;
    margin: 6px 0;
    font-weight: 700;
    transition: background 0.2s;
  }

  .dropdown-menu a:hover {
    background: #8b5e3c;
  }

  /* Mostrar men√∫ activo */
  .menu-container.active .dropdown-menu {
    display: block;
  }

  /* ===== Bot√≥n volver ===== */
  .btn-home {
    display: block;
    width: fit-content;
    margin: 30px auto 0;
    padding: 12px 20px;
    background: #4b2e2e;
    color: #fff;
    text-decoration: none;
    border-radius: 8px;
    font-size: 16px;
    transition: background .2s;
  }
  .btn-home:hover {
    background: #3e2723;
  }

  /* ===== Mensajes ===== */
  .messages-container {
    max-width: 600px;
    margin: 0 auto 20px;
  }
  .message {
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 8px;
    font: 700 15px/1 Arial;
  }
  .message.success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }
  .message.error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }

  /* ===== Filtros ===== */
.filters-form {
  max-width: 1200px;
  margin: 24px auto 30px;
  background: #fffaf3;
  border: 1px solid #e8dcca;
  border-radius: 16px;
  padding: 20px 28px;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
}

.filters-grid {
  display: grid;
  grid-template-columns: repeat(12, 1fr);
  gap: 18px;
  align-items: end;
}

.label {
  display: block;
  margin-bottom: 6px;
  color: #5d4037;
  font-weight: 600;
  font-size: 14px;
}

.input,
.select {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #d6ccc2;
  border-radius: 8px;
  background-color: #fff;
  font-size: 15px;
  color: #4b2e2e;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.input:focus,
.select:focus {
  border-color: #b08968;
  box-shadow: 0 0 0 3px rgba(176, 137, 104, 0.25);
  outline: none;
}

.f-actions {
  grid-column: 1 / -1;
  display: flex;
  gap: 14px;
  justify-content: center;
  margin-top: 10px;
}

.btn-search {
  background-color: #b08968;
  color: #fff;
  border: none;
  padding: 10px 22px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 700;
  font-size: 15px;
  transition: background-color 0.2s, transform 0.1s;
}

.btn-search:hover {
  background-color: #9c6644;
  transform: scale(1.03);
}

.link-clear {
  color: #6d4c41;
  font-weight: 600;
  text-decoration: none;
  align-self: center;
  transition: color 0.2s;
}

.link-clear:hover {
  color: #9c6644;
  text-decoration: underline;
}

@media (max-width: 768px) {
  .filters-grid {
    grid-template-columns: 1fr;
  }
  .f-item {
    grid-column: span 12 !important;
  }
}


  /* ===== Resto de estilos (filtros, tarjetas, etc.) ===== */
  .filters-form {
    max-width: 1200px;
    margin: 16px auto 22px;
    background: #f7efe2;
    border: 1px solid #e8dcca;
    border-radius: 14px;
    padding: 16px;
  }
  .filters-grid {
    display: grid;
    gap: 14px;
    align-items: end;
    grid-template-columns: repeat(12, minmax(0, 1fr));
  }
  .f-item {
    grid-column: span 4;
  }
  .f-actions {
    grid-column: 1 / -1;
    display: flex;
    gap: 12px;
    justify-content: center;
  }

  .inventory-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .card {
    background: #fffaf3;
    border: 1px solid #d9c7a6;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 2px 4px 6px rgba(0,0,0,.1);
    text-align: center;
  }

  .card img {
    width: 100%;
    max-height: 200px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 15px;
  }

  .btn {
    display: inline-block;
    min-width: 150px;
    padding: 12px 20px;
    margin: 10px auto 0;
    font: 700 15px/1 Arial;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-align: center;
  }

  .btn-add { background: #6d4c41; color: #fff; }
  .btn-add:hover { background: #5d4037; }
  .btn-delete { background: #8d3c2b; color: #fff; }
  .btn-delete:hover { background: #6e2c1a; }

  @media (max-width:600px){
    .dropdown-menu { width: 90%; left: 5%; }
  }
</style>

<style>
  .btn-view {
    background: #b08968;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    font-size: 15px;
    transition: background 0.2s, transform 0.1s;
  }

  .btn-view:hover {
    background: #9c6644;
    transform: scale(1.05);
  }

  /* Contenedor desplazable */
  .table-scroll {
    overflow-x: auto;
    margin-top: 15px;
    border-radius: 12px;
  }

  /* Tabla general */
  .inventory-table {
    width: 100%;
    min-width: 900px;
    border-collapse: collapse;
    background: #f8f3ed;
  }

  .inventory-table th, .inventory-table td {
    text-align: left;
    padding: 12px 14px;
    border-bottom: 1px solid #e0d2c3;
    vertical-align: middle;
  }

  .inventory-table th {
    background: #e9decf;
    font-weight: bold;
  }

  .inventory-table img {
    width: 70px;
    height: 70px;
    border-radius: 10px;
    object-fit: cover;
  }

  .table-actions {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .table-actions .btn {
    width: 110px;
  }

  /* Oculta tarjetas normales en modo lista */
  .inventory-container.list-view .card {
    display: none;
  }

  /* Oculta la tabla fuera del modo lista */
  .inventory-table-wrapper {
    display: none;
  }

  .inventory-container.list-view + .inventory-table-wrapper {
    display: block;
  }
</style>

<div style="text-align: right; margin-bottom: 15px;">
  <button id="toggleViewBtn" class="btn-view">üóÇÔ∏è Vista en lista</button>
</div>

<script>
  // Script para alternar el men√∫
  document.addEventListener('DOMContentLoaded', () => {
    const menuContainer = document.querySelector('.menu-container');
    const toggle = document.querySelector('.menu-toggle');

    toggle.addEventListener('click', () => {
      menuContainer.classList.toggle('active');
    });

    // Cierra el men√∫ al hacer clic fuera
    document.addEventListener('click', (e) => {
      if (!menuContainer.contains(e.target)) {
        menuContainer.classList.remove('active');
      }
    });
  });
</script>

{% include "Menu_Inventario.html" %}

<h1>Inventario de Productos</h1>

{% if messages %}
<div class="messages-container">
  {% for message in messages %}
  <div class="message {{ message.tags }}">{{ message }}</div>
  {% endfor %}
</div>
{% endif %}

<!-- ===== Filtros ===== -->
<form method="get" class="filters-form">
  <div class="filters-grid">
    <div class="f-item" style="grid-column: 1 / span 7;">
      <input type="text" name="q" class="input"
        placeholder="Buscar por nombre, descripci√≥n, categor√≠a o proveedor‚Ä¶"
        value="{{ filters.q }}">
    </div>

    <div class="f-item" style="grid-column: 9 / span 4;">
      <label class="label">Categor√≠a</label>
      <select name="category" class="select">
        <option value="">Todas</option>
        {% for c in categories %}
        <option value="{{ c }}" {% if filters.category == c %}selected{% endif %}>{{ c|title }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="f-item" style="grid-column: 1 / span 4;">
      <label class="label">Proveedor</label>
      <select name="supplier" class="select">
        <option value="">Todos</option>
        {% for s in suppliers %}
        <option value="{{ s }}" {% if filters.supplier == s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="f-item" style="grid-column: 5 / span 3;">
      <label class="label">Precio m√≠n</label>
      <input type="number" step="0.01" name="min_price" class="input" value="{{ filters.min_price }}">
    </div>

    <div class="f-item" style="grid-column: 9 / span 3;">
      <label class="label">Precio m√°x</label>
      <input type="number" step="0.01" name="max_price" class="input" value="{{ filters.max_price }}">
    </div>

    <div class="f-actions">
      <button type="submit" class="btn-search">üîé Buscar</button>
      <a href="{% url 'inventory_display' %}" class="link-clear">Limpiar</a>
    </div>
  </div>
</form>

<!-- ===== Productos ===== -->
<div class="inventory-container">
  {% for product in products %}
  <div class="card">
    {% if product.image %}
    <img src="{{ product.image.url }}" alt="{{ product.name }}">
    {% endif %}
    <h2>{{ product.name }}</h2>
    <p><strong>Categor√≠a:</strong> {{ product.get_category_display }}</p>
    {% if product.expiration_date %}
    <p><strong>Fecha de expiraci√≥n:</strong> {{ product.expiration_date }}</p>
    {% endif %}
    <p><strong>Proveedor:</strong> {{ product.supplier }}</p>
    <p><strong>Precio:</strong> ${{ product.price }}</p>
    <p><strong>Stock:</strong> {{ product.quantity }}</p>
    <p><strong>Descripci√≥n:</strong> {{ product.description }}</p>

    <details style="margin-top:10px; background:#f7efe2; border:1px solid #d9c7a6; border-radius:10px; padding:10px;">
      <summary style="cursor:pointer; font-weight:bold; color:#6d4c41;">üìã Sugerencias de Almacenamiento & Manejo</summary>
      <div style="margin-top:8px; text-align:left; color:#4e342e; font-size:14px; white-space:pre-wrap;">
        {{ product.product_assigned_suggestions }}
      </div>
    </details>

    <a href="{% url 'add_unit' product.id %}" class="btn btn-add">‚ûï A√±adir unidad</a>
    <a href="{% url 'delete_product' product.id %}" class="btn btn-delete"
      onclick="return confirm('¬øSeguro que quieres eliminar {{ product.name }}?');">
      üóë Eliminar producto
    </a>
  </div>
  {% empty %}
  <p style="text-align:center; color:#6d4c41;">No hay productos en el inventario.</p>
  {% endfor %}
</div>

<!-- ===== Paginaci√≥n ===== -->
{% if page_obj.has_other_pages %}
  <div style="text-align:center; margin:30px 0;">
    <div style="display:inline-flex; gap:6px; flex-wrap:wrap;">

      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
           style="padding:8px 12px; background:#a97155; color:white; border-radius:6px; text-decoration:none;">
          ‚Üê Anterior
        </a>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <span style="padding:8px 12px; background:#4b2e2e; color:white; border-radius:6px;">{{ num }}</span>
        {% elif num > page_obj.number|add:-3 and num < page_obj.number|add:3 %}
          <a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
             style="padding:8px 12px; background:#d9c7a6; color:#4b2e2e; border-radius:6px; text-decoration:none;">
             {{ num }}
          </a>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
           style="padding:8px 12px; background:#a97155; color:white; border-radius:6px; text-decoration:none;">
          Siguiente ‚Üí
        </a>
      {% endif %}
    </div>
  </div>
{% endif %}

<script>
const toggleBtn = document.getElementById("toggleViewBtn");
const container = document.querySelector(".inventory-container");

let isTableView = false;

toggleBtn.addEventListener("click", () => {
  if (!isTableView) {
    const cards = container.querySelectorAll(".card");
    let tableHTML = `
      <div style="overflow-x:auto;">
        <table style="width:100%; border-collapse:collapse; min-width:900px;">
          <thead>
            <tr style="background:#f1e0c5;">
              <th style="padding:10px;">Imagen</th>
              <th style="padding:10px;">Nombre</th>
              <th style="padding:10px;">Categor√≠a</th>
              <th style="padding:10px;">Proveedor</th>
              <th style="padding:10px;">Precio</th>
              <th style="padding:10px;">Stock</th>
              <th style="padding:10px;">Descripci√≥n</th>
              <th style="padding:10px;">Acciones</th>
            </tr>
          </thead>
          <tbody>
    `;

    cards.forEach(card => {
      const imgSrc = card.querySelector("img")?.src || "";
      const name = card.querySelector("h2")?.innerText || "";
      const categoria = card.querySelector("p:nth-of-type(1)")?.innerText.replace("Categor√≠a: ", "") || "";
      const proveedor = card.querySelector("p:nth-of-type(2)")?.innerText.replace("Proveedor: ", "") || "";
      const precio = card.querySelector("p:nth-of-type(3)")?.innerText.replace("Precio: ", "") || "";
      const stock = card.querySelector("p:nth-of-type(4)")?.innerText.replace("Stock: ", "") || "";
      const descripcion = card.querySelector("p:nth-of-type(5)")?.innerText.replace("Descripci√≥n: ", "") || "";

      // ‚úÖ Tomamos los enlaces originales (mantienen funcionalidad Django)
      const addHref = card.querySelector(".btn-add")?.getAttribute("href") || "#";
      const deleteHref = card.querySelector(".btn-delete")?.getAttribute("href") || "#";
      const deleteConfirm = card.querySelector(".btn-delete")?.getAttribute("onclick") || "";

      tableHTML += `
        <tr style="border-bottom:1px solid #d9a066;">
          <td style="padding:10px; text-align:center;">
            <img src="${imgSrc}" style="max-width:80px; height:auto; border-radius:8px;">
          </td>
          <td style="padding:10px;">${name}</td>
          <td style="padding:10px;">${categoria}</td>
          <td style="padding:10px;">${proveedor}</td>
          <td style="padding:10px;">${precio}</td>
          <td style="padding:10px;">${stock}</td>
          <td style="padding:10px;">${descripcion}</td>
          <td style="padding:10px; text-align:center;">
            <a href="${addHref}" class="btn btn-add"
              style="background:#6d4c41; color:white; padding:6px 10px; border-radius:6px; display:inline-block; margin:2px; text-decoration:none;">
              ‚ûï A√±adir
            </a>
            <a href="${deleteHref}" class="btn btn-delete"
              onclick="${deleteConfirm}"
              style="background:#8d3c2b; color:white; padding:6px 10px; border-radius:6px; display:inline-block; margin:2px; text-decoration:none;">
              üóëÔ∏è Eliminar
            </a>
          </td>
        </tr>
      `;
    });

    tableHTML += `
          </tbody>
        </table>
      </div>
    `;

    // Guardamos las tarjetas originales
    container.dataset.originalContent = container.innerHTML;
    container.innerHTML = tableHTML;
    toggleBtn.textContent = "üî≥ Vista en cuadr√≠cula";
    isTableView = true;

  } else {
    // Volver a vista de cuadr√≠cula
    container.innerHTML = container.dataset.originalContent;
    toggleBtn.textContent = "üóÇÔ∏è Vista en lista";
    isTableView = false;
  }
});
</script>


<a href="{% url 'home' %}" class="btn-home">‚¨Ö Volver a inicio</a>

{% endblock %}
